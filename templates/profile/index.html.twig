{% extends 'base.html.twig' %}

{% block title %}Gestionnaire de participants!
{% endblock %}

{% block body %}

	<div class="example-wrapper">
		<h1 class="mt-5 mb-3 text-uppercase">Gestion des participants</h1>
		{% if app.user %}
			<a class="btn btn-primary" href="{{ path('app_profile_show', {id:app.user.id}) }}">
				Afficher mon profil</a>
			<a class="btn btn-warning text-white" href="{{ path('app_register') }}">Ajouter un participant</a>
			<a class="btn btn-danger text-white" href="{{ path('app_profile_eddit', {id:app.user.id}) }}">modifier mon profil</a>
			<a class="btn btn-success text-white" href="{{ path('app_profile_add_json') }}">Ajouter des utilisateurs via un fichier</a>
		{% endif %}

		<h2 class="mt-5 mb-3 text-uppercase">
			Test de gestionnaire admin
		</h2>
		<div class="table-responsive table-wrapper-scroll-y my-custom-scrollbar">
			<table class="table ">
				<thead>
					<tr>
						<th scope="col">Nom</th>
						<th scope="col">Prénom</th>
						<th scope="col">Email</th>
						<th scope="col">Téléphone</th>
						<th scope="col">Etat du compte</th>
						<th scope="col">Actions</th>
					</tr>
				</thead>
				<tbody>

					{% for participant in participants %}

						{% if not (participant.id == app.user.id)  %}
							<tr>
								<th>{{participant.nom}}</th>
								<td>{{participant.prenom}}</td>
								<td>{{participant.email}}</td>
								<td>{{participant.telephone}}</td>

								{% if participant.actif %}
									<td>
										<a href="{{ path('app_profile_status',{id:participant.id}) }}">
											<span class="badge bg-success">ok</span>
										</a>
									</td>

								{% else %}
									<td>
										<a href="{{ path('app_profile_status',{id:participant.id}) }}">
											<span class="badge bg-dark">na</span>
										</a>
									</td>
								{% endif %}
								<td>
									<a class="btn btn-primary" href="{{ path('app_profile_show', {id:participant.id}) }}">
										<i class="fas fa-eye"></i>
									</a>

									<a class="btn btn-warning text-white" href="{{ path('app_profile_eddit', {id:participant.id}) }}">
										<i class="fas fa-edit"></i>
									</a>
									<button type="button" class="btn btn-danger" data-participantid="{{participant.id}}" data-participantnom="{{participant.nom}}" onclick="deleteVille(this)" data-bs-toggle="modal" data-bs-target="#exampleModal">
										<i class="fas fa-trash"></i>
									</button>
								</td>
							</tr>

						{% endif %}

					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>


	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabelNomVille">Modal title</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
					<a id="exampleBtnNomVille" class="btn btn-danger" href="">
						<i class="fas fa-trash"></i>
					</a>
				</div>
			</div>
		</div>
	</div>


	<script>
		function deleteVille(el) {
let participantId = el.dataset.participantid;

// recuperation du titre
titleElement = document.getElementById('exampleModalLabelNomVille');
aElement = document.getElementById('exampleBtnNomVille');
titleElement.innerText = 'Voulez-vous supprimer l utilisateur "' + el.dataset.participantnom + '" ? ';

p = location.href + "/" + participantId + "/delete";

aElement.href = p;
}
	</script>

{% endblock %}
